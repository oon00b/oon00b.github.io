<!DOCTYPE html><html lang="ja" dir="ltr"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://creativecommons.org/licenses/by/4.0/" rel="license"><title>awkの正規表現で文字列定数を使う場合、特殊文字を二重にエスケープしなければならない</title><style>:root{color-scheme:dark light;overflow-wrap:break-word;line-height:1.6;font-family:sans-serif}*{box-sizing:border-box;min-width:0}body{max-width:98%;margin:auto}@media screen{:root{color:#000000;background:#ffffff}a{color:#002075}a:visited{color:#551000}}@media only screen and (prefers-color-scheme: dark){:root{color:#ffffff;background:#000000}a{color:#d0ffdd}a:visited{color:#fff3cc}}@media print{:root{font-family:serif}a{color:inherit}}a{text-decoration:underline}a:hover,a:focus{outline:thin dashed}a:active{outline:medium solid}@media screen{pre,samp{overflow-x:auto}}pre,code,samp,kbd{font-size:1em;font-family:monospace, monospace}kbd,pre,:not(pre)>code{border-radius:0.25em;padding:0 0.25em;border:thin solid}q::before,blockquote::before{content:open-quote}q::after,blockquote::after{content:close-quote}blockquote::after{text-align:end}blockquote::before,blockquote::after{display:block}table{border-collapse:collapse}th,td{border:thin solid}.blog{min-height:100vh;display:grid;gap:2rem;grid-template-rows:auto 1fr}@media print{.blog{display:block}.blog>:not(.blog-main){display:none}}@media (min-width: 60rem){.blog{grid-template-columns:auto 15rem;grid-template-areas:"navigation navigation" "main side" "footer footer"}.blog-navigation{grid-area:navigation}.blog-main{grid-area:main}.blog-side{grid-area:side}.blog-footer{grid-area:footer}}.post-title{font-size:1.3rem;margin:0}.post-date{display:block}.post-body h1::before{content:"# "}.post-body h2::before{content:"## "}.post-body h3::before{content:"### "}.post-body h4::before{content:"#### "}.post-body h5::before{content:"##### "}.post-body h6::before{content:"###### "}.post-body :is(h1, h2, h3, h4, h5, h6)::before{font-family:monospace}.side{display:flex;flex-wrap:wrap;align-content:start;gap:2rem}.side>*{flex:1 15rem}.archives-title{font-size:1rem;margin:0}.archives-tree>.archives-tree,.archives-post{padding-inline-start:1rem}.archives-post{display:list-item;list-style:disc inside}.tags-title{font-size:1rem;margin:0}</style><body class="blog"><nav class="navigation blog-navigation"><a href="../../../../">Home</a> | <a href="../../../../blog">Blog</a> | <a href="../../../../about">About</a></nav><article class="post blog-main"><h1 class="post-title">awkの正規表現で文字列定数を使う場合、特殊文字を二重にエスケープしなければならない</h1><time class="post-date" datetime="2022-10-16">2022-10-16</time><div class="post-tags">tags: [<a href="../../../../blog/tags/awk/index.html">awk</a>]</div><div class="post-body"><h2 id="環境">環境</h2><p>おそらくPOSIX互換の<code>awk</code>であればどれでも同じ問題が起きるはずだが、一応実行環境を書いておく。</p><ul><li><code>GNU Awk 5.2.0, API 3.2, PMA Avon 7, (GNU MPFR 4.1.0-p13, GNU MP 6.2.1)</code></li></ul><h2 id="概要">概要</h2><p>例えば、現在のレコードが、バックスラッシュを含むか調べようとして、以下の様に書くとエラーになる。</p><pre class="awk"><code># エラー: $0 ~ /\/ と解釈される
$0 ~ &quot;\\&quot; {print &quot;match&quot;}</code></pre><p>これは文字列定数を処理する時と、正規表現の処理をする時とで、合わせて二回、エスケープシーケンスの処理が行われるためだ。つまり、文字列定数を正規表現に使う場合、特殊文字を二重にエスケープしなければならない。</p><pre class="awk"><code># $0 ~ /\\/ と解釈されるので期待通り動く
$0 ~ &quot;\\\\&quot; {print &quot;match&quot;}</code></pre><p>記述が冗長になるので、awkの正規表現には、文字列定数の代わりに、<code>//</code>でパターンを囲うスタイルを使ったほうが良い。</p><h2 id="参考">参考</h2><ul><li><a href="https://www.gnu.org/software/gawk/manual/html_node/Computed-Regexps.html">Computed Regexps (The GNU Awk User’s Guide)</a></li></ul></div></article><aside class="side blog-side"><aside class="archives"><h2 class="archives-title">Archives</h2><details class="archives-tree"><summary><a href="../../../../blog/2022/index.html">2022</a>(2)/</summary><details class="archives-tree"><summary><a href="../../../../blog/2022/10/index.html">2022/10</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2022/10/awk-note-when-using-string-literal-as-regex/index.html">awkの正規表現で文字列定数を使う場合、特殊文字を二重にエスケープしなければならない</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2022/01/index.html">2022/01</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2022/01/suspend-disk-frequently-when-laptop-on-battery/index.html">tlpをインストールしたラップトップで、バッテリー駆動時にSSDのサスペンドが頻発する</a></div></details></details><details class="archives-tree"><summary><a href="../../../../blog/2020/index.html">2020</a>(5)/</summary><details class="archives-tree"><summary><a href="../../../../blog/2020/09/index.html">2020/09</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/09/bash-and-zsh-startup-file/index.html">bash,zshが起動時に読み込む設定ファイル</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/06/index.html">2020/06</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/06/elona-on-archlinux/index.html">Arch Linuxでelonaを動かす方法</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/05/index.html">2020/05</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/05/install-archlinux-in-virtualbox/index.html">VirtualBoxにArch Linuxをインストールする</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/04/index.html">2020/04</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/04/linux-vconsole-color-settings/index.html">Linuxの仮想コンソールの色を設定する</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/02/index.html">2020/02</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/02/vim-source-expr/index.html">vimで式の結果をsourceする方法</a></div></details></details></aside><aside class="tags"><h2 class="tags-title">Tags</h2><a href="../../../../blog/tags/Arch%20Linux/index.html">Arch Linux</a>(2), <a href="../../../../blog/tags/GNU-Linux/index.html">GNU/Linux</a>(2), <a href="../../../../blog/tags/Game/index.html">Game</a>(1), <a href="../../../../blog/tags/Linux/index.html">Linux</a>(1), <a href="../../../../blog/tags/VirtualBox/index.html">VirtualBox</a>(1), <a href="../../../../blog/tags/Wine/index.html">Wine</a>(1), <a href="../../../../blog/tags/awk/index.html">awk</a>(1), <a href="../../../../blog/tags/bash/index.html">bash</a>(1), <a href="../../../../blog/tags/vim/index.html">vim</a>(1), <a href="../../../../blog/tags/zsh/index.html">zsh</a>(1)</aside></aside><footer class="footer blog-footer">このサイトの文章は<a href="https://creativecommons.org/licenses/by/4.0/" rel="license">クリエイティブ・コモンズ 表示 4.0 国際 ライセンス</a>の下に提供されています。</footer>