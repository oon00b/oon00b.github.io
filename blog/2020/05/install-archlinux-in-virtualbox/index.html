<!DOCTYPE html><html lang="ja" dir="ltr"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>VirtualBoxにArch Linuxをインストールする</title><link href="https://creativecommons.org/licenses/by/4.0/" rel="license"><link href="../../../../css/blogpost.css" rel="stylesheet" as="style"><body class="blog"><nav class="navigation blog-navigation"><a href="../../../../">Home</a> | <a href="../../../../blog">Blog</a> | <a href="../../../../about">About</a></nav><article class="post blog-main"><h1 class="post-title">VirtualBoxにArch Linuxをインストールする</h1><time class="post-date" datetime="2020-05-18">2020-05-18</time><div class="post-tags">tags: [<a href="../../../../blog/tags/Arch%20Linux/index.html">Arch Linux</a>] [<a href="../../../../blog/tags/GNU-Linux/index.html">GNU/Linux</a>] [<a href="../../../../blog/tags/VirtualBox/index.html">VirtualBox</a>]</div><div class="post-body"><p>VirtualBoxにArch LinuxをEFI + GPTでインストールする手順を書き残しておく。</p><h2 id="環境">環境</h2><ul><li><code>macOS 10.14.6</code></li><li><code>VirtualBox version 6.1.6</code></li></ul><h2 id="arch-linuxののダウンロード">Arch Linuxののダウンロード</h2><p><a href="https://www.archlinux.jp/download/">ダウンロードページ</a>のリンクから、ISOファイルをダウンロードする。チェックサムとPGP署名の確認もしておく。</p><pre class="sh"><code>printf &quot;&lt;SHA1-CHECKSUM&gt; &lt;ISO&gt;&quot; | sha1sum -c  # チェックサムの確認
gpg --auto-key-retrieve --verify &lt;PGP SIGNATURE&gt; # 署名の確認</code></pre><p><a href="https://www.archlinux.org/people/developers">Archの開発者</a>の鍵の指紋とPGP署名の指紋が一致するか確認しておく。</p><h2 id="arch-linuxのインストール">Arch Linuxのインストール</h2><p>デフォルトだと仮想コンソールのキーマップがUSになっているので、適当に変える。</p><pre class="sh"><code>loadkeys jp106</code></pre><p>システムクロックの設定</p><pre class="sh"><code>timedatectl set-ntp 1</code></pre><p>パーティションの作成。<code>fdisk -l</code>でハードディスクのデバイス名を確認して<code>gdisk</code>を起動する。</p><pre class="sh"><code>gdisk /dev/sda</code></pre><p><code>o</code>コマンドで新しいパーティションテーブルを作成</p><p><code>n</code>コマンドでパーティションを作成。とりあえず、ルートパーティションと<a href="https://wiki.archlinux.jp/index.php/EFI_システムパーティション">ESP(EFI System Partition)</a>だけ作る。</p><p><strong>ESP</strong></p><ul><li>Partition number -&gt; 1</li><li>First sector -&gt; default</li><li>Last sector -&gt; +512M</li><li>Partition type -&gt; ef00 (EFI system)</li></ul><p><strong>ルートパーティション</strong></p><ul><li>Partition number -&gt; 2</li><li>First sector -&gt; default</li><li>Last sector -&gt; default</li><li>Partition type -&gt; 8304 (Linux x86-64 root)</li></ul><p><code>w</code>コマンドで変更を保存</p><p>ファイルシステムのフォーマット。ESPは必ずFATでフォーマットする必要がある。</p><pre class="sh"><code>mkfs.fat -F32 /dev/sda1 # ESP
mkfs.ext4 /dev/sda2     # root</code></pre><p>ファイルシステムのマウント。ルートから順にマウントする。</p><pre class="sh"><code>mount /dev/sda2 /mnt      # root
mkdir /mnt/boot
mount /dev/sda1 /mnt/boot # ESP</code></pre><p><code>/etc/pacman.d/mirrorlist</code>を開いて日本のサーバーを上に持ってくる。</p><p>ミラーから必須パッケージと他に要りそうなパッケージをインストールする。</p><pre class="sh"><code>pacstrap /mnt base linux linux-firmware vim man-db man-pages texinfo</code></pre><p>fstabを生成</p><pre class="sh"><code>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</code></pre><p>インストール先にchroot</p><pre class="sh"><code>arch-chroot /mnt</code></pre><p>タイムゾーンの設定</p><pre class="sh"><code>ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
hwclock -w</code></pre><p><code>/etc/locale.gen</code>を開き、<code>en_US.UTF-8 UTF-8</code>の行をアンコメントして、ロケールを生成する。</p><pre class="sh"><code>locale-gen
echo &quot;LANG=\&quot;en_US.UTF-8\&quot;&quot; &gt; /etc/locale.conf</code></pre><p>仮想コンソールのキーマップの設定を永続化</p><pre class="sh"><code>echo &quot;KEYMAP=\&quot;jp106\&quot;&quot; &gt; /etc/vconsole.conf</code></pre><p>hostnameの設定</p><pre class="sh"><code>echo &quot;&lt;MYHOSTNAME&gt;&quot; &gt; /etc/hostname</code></pre><p><code>/etc/hosts</code>の編集</p><pre><code>127.0.0.1 localhost
::1       localhost
127.0.1.1 &lt;MYHOSTNAME&gt;.localdomain &lt;MYHOSTNAME&gt;</code></pre><p><a href="https://wiki.archlinux.jp/index.php/Systemd-networkd">systemd-networkd</a>のネットワークの設定を書く。<code>en*</code>にマッチするデバイスで、DHCPクライアントを有効にする場合、以下のように書く。</p><pre><code>[Match]
Name=en*

[Network]
DHCP=yes</code></pre><p>設定は、<code>/etc/systemd/network/</code>以下に、<code>&lt;FOOBAR&gt;.network</code>みたいなファイル名で保存する。</p><p>設定が終わったら、サービスを有効化しておく。</p><pre class="sh"><code>systemctl enable systemd-networkd.service</code></pre><p><code>/etc/resolv.conf</code>の編集</p><pre><code># cloudflare DNS
nameserver 1.1.1.1
nameserver 1.0.0.1</code></pre><p>rootのパスワードを設定</p><pre class="sh"><code>passwd</code></pre><p><a href="https://wiki.archlinux.jp/index.php/GRUB">GRUB</a>のインストール</p><pre class="sh"><code>pacman -S grub efibootmgr
grub-install --efi-directory=/boot --target=x86_64-efi --bootloader-id=&lt;ID&gt;
grub-mkconfig -o /boot/grub/grub.cfg</code></pre><h2 id="インストール後の作業">インストール後の作業</h2><p>とりあえず、sudoとXの設定、VirtualBox Guest Additionsのインストールまでやっておく。</p><h3 id="sudoの設定">sudoの設定</h3><p>ユーザーを追加して、<a href="https://wiki.archlinux.jp/index.php/Sudo">sudo</a>の設定をする。</p><p>ユーザーの追加</p><pre class="sh"><code>useradd -m -s /bin/bash -G wheel &lt;USERNAME&gt;
passwd &lt;USERNAME&gt;</code></pre><p>sudoとviをインストールする。</p><pre class="sh"><code>pacman -S sudo vi</code></pre><p>visudoを起動して<code>%wheel ALL=(ALL) ALL</code>の行を、アンコメントする。</p><p>ルートアカウントをロックする。</p><pre class="sh"><code>passwd -l root</code></pre><h3 id="xの設定">Xの設定</h3><p><a href="https://wiki.archlinux.jp/index.php/Xorg">X</a>関連のソフトウェアとドライバーをインストールする。</p><pre class="sh"><code>sudo pacman -S xorg-server xorg-apps xorg-xinit xclip xf86-video-vmware xf86-input-vmmouse</code></pre><p>フォントをインストール</p><pre class="sh"><code>sudo pacman -S noto-fonts xorg-fonts-100dpi</code></pre><p><code>${XDG_CONFIG_HOME:-"${HOME}/.config"}/fontconfig/fonts.conf</code>に<a href="https://wiki.archlinux.jp/index.php/フォント設定">フォントの設定</a>を書く。</p><pre class="xml"><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE fontconfig SYSTEM &quot;fonts.dtd&quot;&gt;
&lt;fontconfig&gt;
    &lt;match target=&quot;font&quot;&gt;
        &lt;edit name=&quot;embeddedbitmap&quot;&gt;
            &lt;bool&gt;false&lt;/bool&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

    &lt;match&gt;
        &lt;test name=&quot;family&quot;&gt;
            &lt;string&gt;sans-serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name=&quot;family&quot; binding=&quot;strong&quot;&gt;
            &lt;string&gt;Noto Sans&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

    &lt;match&gt;
        &lt;test name=&quot;family&quot;&gt;
            &lt;string&gt;serif&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name=&quot;family&quot; binding=&quot;strong&quot;&gt;
            &lt;string&gt;Noto Serif&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;

    &lt;match&gt;
        &lt;test name=&quot;family&quot;&gt;
            &lt;string&gt;monospace&lt;/string&gt;
        &lt;/test&gt;
        &lt;edit name=&quot;family&quot; binding=&quot;strong&quot;&gt;
            &lt;string&gt;Noto Sans Mono&lt;/string&gt;
        &lt;/edit&gt;
    &lt;/match&gt;
&lt;/fontconfig&gt;</code></pre><p><a href="https://wiki.archlinux.jp/index.php/I3">i3</a>、<a href="https://wiki.archlinux.jp/index.php/Dmenu">dmenu</a>、<a href="https://wiki.archlinux.jp/index.php/Alacritty">alacritty</a>をインストール</p><pre class="sh"><code>sudo pacman -S i3 dmenu alacritty</code></pre><p><code>/etc/X11/xinit/xinitrc</code>を<code>~/.xinitrc</code>にコピーして、編集する。</p><pre class="sh"><code>#!/bin/sh

if [ -d /etc/X11/xinit/xinitrc.d ] ; then
 for f in /etc/X11/xinit/xinitrc.d/?* ; do
  [ -x &quot;$f&quot; ] &amp;&amp; . &quot;$f&quot;
 done
 unset f
fi

setxkbmap -layout jp
xset r rate 150 60

exec i3</code></pre><p><code>startx</code>コマンドでXを起動できる。</p><h3 id="guest-additionsのインストール">Guest Additionsのインストール</h3><p><code>virtualbox-guest-utils</code>パッケージをインストールして、<code>vboxservice</code>サービスを有効化する。</p><pre class="sh"><code>sudo pacman -S virtualbox-guest-utils
sudo systemctl enable vboxservice.service</code></pre><p>Xの起動中に、<code>VBoxClient-all</code>コマンドを実行すれば、Guest Additionsの機能が使えるようになる。</p><h4 id="vmsvgaでゲストのウィンドウサイズを変更したい場合">VMSVGAでゲストのウィンドウサイズを変更したい場合</h4><p>VMSVGAでゲストのウィンドウサイズを変更したい場合、pacmanではなくCDから、Guest Additionsをインストールしないといけないらしい。(<a href="https://wiki.archlinux.org/index.php/VirtualBox#Guest_display_auto-resizing_does_not_work_in_Arch_guests">参考</a>)</p><p>CDからGuest Additionsをインストールする方法を書き残しておく。</p><p>Guest Additionsのカーネルモジュールのビルドに必要なパッケージをインストール。</p><pre class="sh"><code>sudo pacman -S gcc make linux-headers</code></pre><p>VMのメニューバーから<strong>Devices</strong>-&gt;<strong>Insert Guest Additinos CD image…</strong>を選択してCDを挿入。マウントする。</p><pre class="sh"><code>sudo mkdir /mnt/guestadd
sudo mount /dev/sr0 /mnt/guestadd</code></pre><p>マウント先に移動して、rootで<code>VBoxLinuxAdditions.run</code>スクリプトを実行する。</p><pre class="sh"><code>cd /mnt/guestadd
sudo sh ./VBoxLinuxAdditions.run</code></pre><p>再起動してインストールしたカーネルモジュールを読み込ませる。</p><pre class="sh"><code>cd ~
sudo umount /mnt/guestadd
sudo rmdir /mnt/guestadd
sudo systemctl reboot</code></pre><p>CDからインストールした場合、<code>startx</code>時に、<code>/etc/X11/xinit/xinitrc.d/98vboxadd-xclient.sh</code>でGuest Additionsの機能が有効化されるようになっている。</p><h2 id="参考">参考</h2><ul><li><a href="https://wiki.archlinux.jp/index.php/インストールガイド">インストールガイド - ArchWiki</a></li><li><a href="https://wiki.archlinux.jp/index.php/VirtualBox">VirtualBox - ArchWiki</a></li><li><a href="https://www.virtualbox.org/manual/ch04.html#additions-linux">Chapter 4. Guest Additions#additions-linux</a></li></ul></div></article><aside class="side blog-side"><aside class="archives"><h2 class="archives-title">Archives</h2><details class="archives-tree"><summary><a href="../../../../blog/2022/index.html">2022</a>(2)/</summary><details class="archives-tree"><summary><a href="../../../../blog/2022/10/index.html">2022/10</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2022/10/awk-note-when-using-string-literal-as-regex/index.html">awkの正規表現で文字列定数を使う場合、特殊文字を二重にエスケープしなければならない</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2022/01/index.html">2022/01</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2022/01/suspend-disk-frequently-when-laptop-on-battery/index.html">tlpをインストールしたラップトップで、バッテリー駆動時にSSDのサスペンドが頻発する</a></div></details></details><details class="archives-tree"><summary><a href="../../../../blog/2020/index.html">2020</a>(6)/</summary><details class="archives-tree"><summary><a href="../../../../blog/2020/09/index.html">2020/09</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/09/bash-and-zsh-startup-file/index.html">bash,zshが起動時に読み込む設定ファイル</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/06/index.html">2020/06</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/06/elona-on-archlinux/index.html">Arch Linuxでelonaを動かす方法</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/05/index.html">2020/05</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/05/install-archlinux-in-virtualbox/index.html">VirtualBoxにArch Linuxをインストールする</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/04/index.html">2020/04</a>(1)/</summary><div class="archives-post"><a href="../../../../blog/2020/04/linux-vconsole-color-settings/index.html">Linuxの仮想コンソールの色を設定する</a></div></details><details class="archives-tree"><summary><a href="../../../../blog/2020/02/index.html">2020/02</a>(2)/</summary><div class="archives-post"><a href="../../../../blog/2020/02/prevent-spotlightv100-fseventsd/index.html">[macOS]USBメモリー内に.Spotlight-V100と.fseventsdを作らせないようにする</a></div><div class="archives-post"><a href="../../../../blog/2020/02/vim-source-expr/index.html">vimで式の結果をsourceする方法</a></div></details></details></aside><aside class="tags"><h2 class="tags-title">Tags</h2><a href="../../../../blog/tags/Arch%20Linux/index.html">Arch Linux</a>(2), <a href="../../../../blog/tags/GNU-Linux/index.html">GNU/Linux</a>(2), <a href="../../../../blog/tags/Game/index.html">Game</a>(1), <a href="../../../../blog/tags/Linux/index.html">Linux</a>(1), <a href="../../../../blog/tags/VirtualBox/index.html">VirtualBox</a>(1), <a href="../../../../blog/tags/Wine/index.html">Wine</a>(1), <a href="../../../../blog/tags/awk/index.html">awk</a>(1), <a href="../../../../blog/tags/bash/index.html">bash</a>(1), <a href="../../../../blog/tags/macOS/index.html">macOS</a>(1), <a href="../../../../blog/tags/vim/index.html">vim</a>(1), <a href="../../../../blog/tags/zsh/index.html">zsh</a>(1)</aside></aside><footer class="footer blog-footer">このサイトの文章は<a href="https://creativecommons.org/licenses/by/4.0/" rel="license">クリエイティブ・コモンズ 表示 4.0 国際 ライセンス</a>の下に提供されています。</footer>